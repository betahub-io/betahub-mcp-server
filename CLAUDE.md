# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Model Context Protocol (MCP) server for BetaHub. MCP is a protocol that allows applications to provide context to Large Language Models in a standardized way. This server acts as a bridge between the BetaHub API (`https://app.betahub.io/`) and AI applications that support MCP.

## Architecture

### Core Components

- **MCP Server**: Built using `@modelcontextprotocol/sdk`, implements the MCP specification
- **BetaHub API Integration**: HTTP client for interacting with BetaHub's REST API
- **Transport**: Uses stdio transport for communication with MCP clients
- **Schema Validation**: Uses Zod for runtime type checking and validation

### Key Files

- `src/index.ts` - Main server implementation and entry point
- `package.json` - Dependencies and build scripts
- `tsconfig.json` - TypeScript configuration for ES2022 with Node16 modules
- `build/` - Compiled JavaScript output (generated by build process)

### Current Implementation Status

The server includes:
- Authentication system using BetaHub's token verification endpoint
- MCP tools for interacting with BetaHub projects and feature requests
- HTTP utility functions for authenticated API requests
- Proper TypeScript configuration for Node.js ES modules

### Available MCP Tools

#### 1. `listProjects`
Lists all BetaHub projects accessible to the authenticated user.

**Parameters:** None

**Response:** Returns project information including:
- Project ID, name, and description
- Member count and creation date
- Direct links to BetaHub project pages

#### 2. `listSuggestions`
Lists feature requests (suggestions) from a specific BetaHub project.

**Parameters:**
- `projectId` (required): The project ID to fetch feature requests from
- `sort` (optional): Sort order - `top`, `new`, `all`, `moderation`, `rejected`, `muted`, `duplicates` (default: `top`)
- `page` (optional): Page number for pagination (default: 1)
- `limit` (optional): Number of items per page, max 25 (default: 25)

**Response:** Returns feature request information including:
- Feature request details (title, description, status)
- Vote counts and user voting status
- User information and timestamps
- Pagination metadata
- Direct links to BetaHub feature request pages

### Usage Examples

#### Example 1: List all accessible projects
```bash
# MCP clients can call the listProjects tool with no parameters
listProjects()
```

#### Example 2: Get top feature requests from BetaHub project
```bash
# Get the most popular feature requests from the BetaHub project
listSuggestions({
  "projectId": "pr-0690627851",
  "sort": "top",
  "limit": 10
})
```

#### Example 3: Get recent feature requests with pagination
```bash
# Get the newest feature requests, second page
listSuggestions({
  "projectId": "pr-0690627851",
  "sort": "new",
  "page": 2,
  "limit": 5
})
```

### Testing the Server

You can test the server's functionality by accessing projects like:
- `pr-0690627851` - BetaHub project (has 25+ feature requests)
- `pr-5287510306` - Demo Game: VoidBreach
- `pr-5622767318` - Scythe Digital Edition

The server has been successfully tested with real BetaHub data and can retrieve both project listings and feature requests from authenticated projects.

## Authentication Setup

The BetaHub MCP server requires authentication using BetaHub tokens. Set your token using the `BETAHUB_TOKEN` environment variable.

### Supported Token Types

1. **Personal Access Tokens** (Recommended)
   - Format: `pat-{64-character-hex}`
   - Create at: Profile ‚Üí Personal Access Tokens in BetaHub
   - Provides full user access to your projects

2. **Project Auth Tokens**
   - Format: `tkn-{64-character-hex}`
   - Create at: Project Settings ‚Üí Auth Tokens
   - Scoped to specific project with defined permissions

3. **JWT Tokens**
   - Temporary tokens for specific sessions
   - Obtained through BetaHub web authentication flow

### Environment Setup
```bash
# Set your BetaHub token
export BETAHUB_TOKEN="pat-your-personal-access-token-here"

# Or for project-specific access
export BETAHUB_TOKEN="tkn-your-project-token-here"
```

## Development Commands

### Build and Development
```bash
# Build the TypeScript project
npm run build

# The build process compiles src/ to build/ and makes the binary executable
```

### Testing

The project uses Vitest as its testing framework with MSW for HTTP mocking.

```bash
# Run tests once
npm test

# Watch mode for development
npm run test:watch

# Interactive UI for debugging tests
npm run test:ui

# Generate coverage report
npm run test:coverage
```

#### Test Structure
Tests are organized in `src/__tests__/`:
- `auth.test.ts` - Authentication and token validation tests
- `tools.test.ts` - MCP tool functionality and input validation tests
- `integration.test.ts` - End-to-end API integration tests
- `setup.ts` - MSW mock server configuration and utilities

#### Adding New Tests
When adding new functionality:
1. Create corresponding test files in `src/__tests__/`
2. Use MSW handlers in `setup.ts` for mocking API responses
3. Tests are excluded from the TypeScript build process
4. All tests run in Node.js environment with ES modules

### Running the Server
```bash
# Set your token first
export BETAHUB_TOKEN="pat-your-token-here"

# After building, run the MCP server
./build/index.js

# Or use the npm bin reference
npx betahub-mcp-server

# You can also pass the token as a command line argument
./build/index.js --token=pat-your-token-here
```

### Authentication Validation

The server validates your token on startup using BetaHub's `/auth/verify` endpoint. You'll see output like:

```
üîê Validating BetaHub token...
‚úÖ Token validated successfully!
   Token Type: personal_access_token
   User: John Doe (john@example.com)
   Expires: 2024-12-31T23:59:59Z
üöÄ BetaHub MCP Server is running
```

## Technical Details

### TypeScript Configuration
- Target: ES2022
- Module system: Node16 (ESM)
- Strict mode enabled
- Output directory: `./build`

### Dependencies
- `@modelcontextprotocol/sdk` - Core MCP implementation
- `zod` - Runtime type validation
- TypeScript and Node.js types for development

### MCP Integration
This server can be integrated with AI applications that support MCP by:
1. Building the project (`npm run build`)
2. Configuring the AI application to use this server via stdio transport
3. The server will communicate via stdin/stdout using the MCP protocol

## Development Notes

### Adding MCP Capabilities
To extend this server, you'll typically want to add:
- **Resources**: Static or dynamic content that can be retrieved
- **Tools**: Functions that the AI can call to perform actions
- **Prompts**: Reusable prompt templates

#### Important: Tool Descriptions and Input Schemas
When creating or updating MCP tools, it's crucial to provide:
1. **Clear tool descriptions**: These are sent to AI clients via the MCP protocol and help them understand what each tool does
   - Set in the `description` field when registering a tool
   - Should be concise but informative

2. **Detailed input schema descriptions**: Use Zod's `.describe()` method for each parameter
   - These descriptions explain what each parameter is for
   - They appear in AI assistants' tool documentation
   - Example: `z.string().describe("The project ID to fetch feature requests from")`

These descriptions aren't just documentation - they're functional metadata that AI assistants (like Claude) rely on to understand and properly use the tools. Without good descriptions, AI clients may not know when or how to use your tools correctly.

### API Integration Patterns
The existing `makeGetRequest` function provides a foundation for BetaHub API calls:
- Includes proper User-Agent header
- Error handling for HTTP failures
- Returns parsed JSON responses

### Node.js Compatibility
- Requires Node.js v18+ (per MCP SDK requirements)
- Uses ES modules (type: "module" in package.json)
- Configured for modern JavaScript features (ES2022)